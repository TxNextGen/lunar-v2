---
import '@/main.css';
import ImportLucide from '../layouts/lucide.astro';
---

<html lang="en">
  <head>
    <title>Settings</title>
    <style>
      .toggle {
        width: 40px;
        height: 22px;
        background: var(--background-overlay);
        border-radius: 11px;
        cursor: pointer;
        position: relative;
        border: 1px solid rgba(255, 255, 255, 0.08);
      }
      .toggle::after {
        content: '';
        position: absolute;
        top: 2px;
        left: 2px;
        width: 16px;
        height: 16px;
        background: var(--text-secondary);
        border-radius: 50%;
        transition: 0.15s;
      }
      .toggle.active {
        background: #6366f1;
        border-color: #6366f1;
      }
      .toggle.active::after {
        left: 20px;
        background: #fff;
      }
      .toast {
        animation: toast 0.2s ease;
      }
      @keyframes toast {
        from {
          opacity: 0;
          transform: translateY(6px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
    </style>
  </head>

  <body class="bg-background font-linux text-text-header min-h-screen p-6 md:p-8">
    <div class="mx-auto max-w-5xl">
      <div class="flex gap-8">
        <nav class="hidden w-48 shrink-0 lg:block">
          <div class="sticky top-6 space-y-1">
            <header class="mb-8">
              <h1 class="mb-1 text-2xl font-bold">Settings</h1>
              <p class="text-text-secondary text-sm">Customize Lunar</p>
            </header>
            <a
              href="#privacy"
              class="nav-item hover:text-text-header flex items-center gap-2.5 rounded-lg bg-[#6366f1]/10 px-3 py-2 text-sm text-[#6366f1] hover:bg-white/5"
              data-nav="privacy"
            >
              <i data-lucide="shield" class="h-4 w-4"></i>Privacy
            </a>
            <a
              href="#browsing"
              class="nav-item text-text-secondary hover:text-text-header flex items-center gap-2.5 rounded-lg px-3 py-2 text-sm hover:bg-white/5"
              data-nav="browsing"
            >
              <i data-lucide="globe" class="h-4 w-4"></i>Browsing
            </a>
            <a
              href="#advanced"
              class="nav-item text-text-secondary hover:text-text-header flex items-center gap-2.5 rounded-lg px-3 py-2 text-sm hover:bg-white/5"
              data-nav="advanced"
            >
              <i data-lucide="wrench" class="h-4 w-4"></i>Advanced
            </a>
            <a
              href="#about"
              class="nav-item text-text-secondary hover:text-text-header flex items-center gap-2.5 rounded-lg px-3 py-2 text-sm hover:bg-white/5"
              data-nav="about"
            >
              <i data-lucide="info" class="h-4 w-4"></i>About
            </a>
          </div>
        </nav>

        <main class="flex-1 space-y-10">
          <section id="privacy" data-section="privacy">
            <h2 class="mb-4 flex items-center text-lg font-semibold">
              <i data-lucide="shield" class="mr-2 h-5 w-5 text-[#6366f1]"></i>
              Privacy & Cloaking
            </h2>

            <div class="space-y-3">
              <div class="bg-background-overlay/60 rounded-xl border border-white/6 p-5">
                <h3 class="mb-2 font-medium">About:Blank Cloak</h3>
                <p class="text-text-secondary mb-3 text-sm">Opens Lunar in a blank tab to hide from history</p>
                <input
                  type="text"
                  data-input="aboutBlankUrl"
                  class="bg-background/80 mb-3 w-full rounded-lg border border-white/6 px-3 py-2.5 text-sm focus:border-[#6366f1]/40 focus:outline-none"
                  placeholder="Redirect URL (e.g. https://classroom.google.com)"
                />
                <button
                  data-about-blank
                  class="flex items-center gap-2 rounded-lg border border-[#6366f1]/30 bg-[#6366f1]/15 px-4 py-2 text-sm hover:bg-[#6366f1]/25"
                >
                  <i data-lucide="external-link" class="h-4 w-4"></i>Open in About:Blank
                </button>
              </div>

              <div class="bg-background-overlay/60 rounded-xl border border-white/6 p-5" data-cloak-container>
                <div class="mb-4 flex items-center justify-between">
                  <div>
                    <h3 class="font-medium">Tab Cloak</h3>
                    <p class="text-text-secondary text-sm">Change tab title and icon</p>
                  </div>
                  <div class="toggle" data-toggle="cloak"></div>
                </div>

                <div data-cloak-inputs class="space-y-3 border-t border-white/6 pt-4">
                  <div class="flex gap-2">
                    <button
                      data-cloak-preset="google"
                      data-preset-title="Google"
                      data-preset-favicon="/a/images/co/go.ico"
                      class="cloak-preset bg-background/60 hover:bg-background/80 flex flex-1 items-center justify-center gap-2 rounded-lg border border-white/6 px-3 py-2 text-sm"
                    >
                      <img src="/a/images/co/go.ico" class="h-4 w-4" alt="" />Google
                    </button>
                    <button
                      data-cloak-preset="drive"
                      data-preset-title="Google Drive"
                      data-preset-favicon="/a/images/co/drei.png"
                      class="cloak-preset bg-background/60 hover:bg-background/80 flex flex-1 items-center justify-center gap-2 rounded-lg border border-white/6 px-3 py-2 text-sm"
                    >
                      <img src="/a/images/co/drei.png" class="h-4 w-4" alt="" />Drive
                    </button>
                    <button
                      data-cloak-preset="classroom"
                      data-preset-title="Home"
                      data-preset-favicon="/a/images/co/class.png"
                      class="cloak-preset bg-background/60 hover:bg-background/80 flex flex-1 items-center justify-center gap-2 rounded-lg border border-white/6 px-3 py-2 text-sm"
                    >
                      <img src="/a/images/co/class.png" class="h-4 w-4" alt="" />Classroom
                    </button>
                  </div>
                  <input
                    type="text"
                    data-input="cloakTitle"
                    placeholder="Tab title"
                    disabled
                    class="cloak-input bg-background/80 w-full rounded-lg border border-white/6 px-4 py-2.5 text-sm focus:border-[#6366f1]/40 focus:outline-none disabled:opacity-50"
                  />
                  <input
                    type="text"
                    data-input="cloakFavicon"
                    placeholder="Favicon URL"
                    disabled
                    class="cloak-input bg-background/80 w-full rounded-lg border border-white/6 px-4 py-2.5 text-sm focus:border-[#6366f1]/40 focus:outline-none disabled:opacity-50"
                  />
                </div>
              </div>

              <div
                class="bg-background-overlay/60 flex items-center justify-between rounded-xl border border-white/6 p-5"
              >
                <div>
                  <h3 class="font-medium">Tab Switch Cloak</h3>
                  <p class="text-text-secondary text-sm">Auto-cloak when you switch tabs</p>
                </div>
                <div class="toggle" data-toggle="tabSwitchCloak"></div>
              </div>

              <div
                class="bg-background-overlay/60 flex items-center justify-between rounded-xl border border-white/6 p-5"
              >
                <div>
                  <h3 class="font-medium">Anti-close</h3>
                  <p class="text-text-secondary text-sm">Confirm before closing the tab</p>
                </div>
                <div class="toggle" data-toggle="beforeUnload"></div>
              </div>

              <div class="bg-background-overlay/60 rounded-xl border border-white/6 p-5">
                <h3 class="mb-2 font-medium">Panic Key</h3>
                <p class="text-text-secondary mb-3 text-sm">Quickly redirect with a keybind</p>
                <div class="grid grid-cols-1 gap-3 sm:grid-cols-2">
                  <input
                    type="text"
                    data-input="panicLoc"
                    placeholder="URL to redirect to"
                    class="bg-background/80 w-full rounded-lg border border-white/6 px-4 py-2.5 text-sm focus:border-[#6366f1]/40 focus:outline-none"
                  />
                  <input
                    type="text"
                    data-input="panicKey"
                    placeholder="Click to set keybind"
                    readonly
                    class="bg-background/80 w-full cursor-pointer rounded-lg border border-white/6 px-4 py-2.5 text-sm focus:border-[#6366f1]/40 focus:outline-none"
                  />
                </div>
              </div>
            </div>
          </section>

          <section id="browsing" data-section="browsing">
            <h2 class="mb-4 flex items-center gap-2 text-lg font-semibold">
              <i data-lucide="globe" class="h-5 w-5 text-pink-400"></i>
              Browsing
            </h2>

            <div class="space-y-3">
              <div class="bg-background-overlay/60 rounded-xl border border-white/6 p-5">
                <h3 class="mb-3 font-medium">Proxy Backend</h3>
                <div class="grid grid-cols-2 gap-3">
                  <button
                    data-proxy="scramjet"
                    class="proxy-button bg-background/60 relative rounded-lg border border-white/6 p-4 text-left hover:border-[#6366f1]/30 hover:bg-[#6366f1]/10"
                  >
                    <div class="text-sm font-medium">Scramjet</div>
                    <div class="text-text-secondary text-xs">Faster, some sites may break</div>
                    <div class="proxy-check absolute top-2 right-2 hidden">
                      <i data-lucide="check" class="h-4 w-4 text-[#6366f1]"></i>
                    </div>
                  </button>
                  <button
                    data-proxy="ultraviolet"
                    class="proxy-button bg-background/60 relative rounded-lg border border-white/6 p-4 text-left hover:border-pink-400/30 hover:bg-pink-400/10"
                  >
                    <div class="text-sm font-medium">Ultraviolet</div>
                    <div class="text-text-secondary text-xs">More stable, slower</div>
                    <div class="proxy-check absolute top-2 right-2 hidden">
                      <i data-lucide="check" class="h-4 w-4 text-pink-400"></i>
                    </div>
                  </button>
                </div>
              </div>

              <div class="bg-background-overlay/60 rounded-xl border border-white/6 p-5">
                <h3 class="mb-3 font-medium">Search Engine</h3>
                <div class="mb-4 grid grid-cols-4 gap-2">
                  <button
                    data-engine="https://duckduckgo.com/?q="
                    class="engine-button bg-background/60 relative flex items-center justify-center gap-2 rounded-lg border border-white/6 py-2.5 text-xs hover:bg-[#6366f1]/10"
                  >
                    <img src="/a/images/engines/ddg.ico" alt="DuckDuckGo" class="h-4 w-4" />
                    DuckDuckGo
                    <div class="engine-check absolute -top-1 -right-1 hidden">
                      <i data-lucide="check-circle" class="h-3.5 w-3.5 text-[#6366f1]"></i>
                    </div>
                  </button>
                  <button
                    data-engine="https://www.google.com/search?q="
                    class="engine-button bg-background/60 relative flex items-center justify-center gap-2 rounded-lg border border-white/6 py-2.5 text-xs hover:bg-[#6366f1]/10"
                  >
                    <img src="/a/images/co/go.ico" alt="Google" class="h-4 w-4" />
                    Google
                    <div class="engine-check absolute -top-1 -right-1 hidden">
                      <i data-lucide="check-circle" class="h-3.5 w-3.5 text-[#6366f1]"></i>
                    </div>
                  </button>
                  <button
                    data-engine="https://www.bing.com/search?q="
                    class="engine-button bg-background/60 relative flex items-center justify-center gap-2 rounded-lg border border-white/6 py-2.5 text-xs hover:bg-[#6366f1]/10"
                  >
                    <img src="/a/images/engines/bi.ico" alt="Bing" class="h-4 w-4" />
                    Bing
                    <div class="engine-check absolute -top-1 -right-1 hidden">
                      <i data-lucide="check-circle" class="h-3.5 w-3.5 text-[#6366f1]"></i>
                    </div>
                  </button>
                  <button
                    data-engine="https://search.brave.com/search?q="
                    class="engine-button bg-background/60 relative flex items-center justify-center gap-2 rounded-lg border border-white/6 py-2.5 text-xs hover:bg-[#6366f1]/10"
                  >
                    <img src="/a/images/engines/br.jpeg" alt="Brave" class="h-4 w-4" />
                    Brave
                    <div class="engine-check absolute -top-1 -right-1 hidden">
                      <i data-lucide="check-circle" class="h-3.5 w-3.5 text-[#6366f1]"></i>
                    </div>
                  </button>
                </div>
                <input
                  type="text"
                  data-input="engine"
                  placeholder="Custom search URL (ends with ?q= or &q=)"
                  class="bg-background/80 w-full rounded-lg border border-white/6 px-4 py-2.5 text-sm focus:border-[#6366f1]/40 focus:outline-none"
                />
              </div>
              <div
                class="bg-background-overlay/60 flex items-center justify-between rounded-xl border border-white/6 p-5"
              >
                <div>
                  <h3 class="font-medium">Ad Block (experimental)</h3>
                  <p class="text-text-secondary text-sm">Block ads and trackers while browsing</p>
                </div>
                <div class="toggle" data-toggle="adBlock"></div>
              </div>
            </div>
          </section>

          <section id="advanced" data-section="advanced">
            <h2 class="mb-4 flex items-center gap-2 text-lg font-semibold">
              <i data-lucide="wrench" class="h-5 w-5 text-amber-400"></i>
              Advanced
            </h2>

            <div class="space-y-3">
              <div class="bg-background-overlay/60 rounded-xl border border-white/6 p-5">
                <h3 class="mb-2 font-medium">Wisp Server</h3>
                <p class="text-text-secondary mb-3 text-sm">Change the websocket server URL</p>
                <input
                  type="text"
                  data-input="wispUrl"
                  placeholder="ws://localhost:3000/wisp/"
                  class="bg-background/80 w-full rounded-lg border border-white/6 px-4 py-2.5 text-sm focus:border-[#6366f1]/40 focus:outline-none"
                />
              </div>

              <div class="bg-background-overlay/60 rounded-xl border border-red-500/20 p-5">
                <h3 class="mb-2 flex items-center gap-2 font-medium text-amber-400">
                  <i data-lucide="alert-triangle" class="h-4 w-4"></i>
                  Clear All Data
                </h3>
                <p class="text-text-secondary mb-3 text-sm">This action cannot be undone</p>
                <button
                  data-reset="reset"
                  class="rounded-lg border border-red-500/30 bg-red-500/10 px-4 py-2 text-sm text-red-400 hover:bg-red-500/20"
                >
                  Clear All Data
                </button>
              </div>
            </div>
          </section>

          <section id="about" data-section="about">
            <h2 class="mb-4 flex items-center gap-2 text-lg font-semibold">
              <i data-lucide="info" class="h-5 w-5 text-[#6366f1]"></i>
              About
            </h2>

            <div class="bg-background-overlay/60 rounded-xl border border-white/6 p-5">
              <div class="mb-4 flex items-center gap-4">
                <div class="flex h-12 w-12 items-center justify-center rounded-xl bg-[#6366f1]/20">
                  <i data-lucide="moon" class="h-6 w-6 text-[#6366f1]"></i>
                </div>
                <div>
                  <h3 class="text-lg font-semibold">Lunar v2</h3>
                  <p class="text-text-secondary text-sm">v{VERSION}</p>
                </div>
              </div>

              <div class="mb-4 space-y-2 text-sm">
                <div class="flex justify-between">
                  <span class="text-text-secondary">Developed by</span><span>Bearcattt</span>
                </div>
                <div class="flex justify-between">
                  <span class="text-text-secondary">Built with</span><span>Astro, TypeScript, Tailwind</span>
                </div>
              </div>

              <div class="flex gap-2">
                <a
                  href="https://github.com/lunar-proxy/lunar-v2"
                  target="_blank"
                  class="bg-background/60 hover:bg-background/80 flex items-center gap-2 rounded-lg border border-white/6 px-3 py-2 text-sm"
                >
                  <i data-lucide="github" class="h-4 w-4"></i>GitHub
                </a>
                <a
                  href="https://discord.gg/fuPtWjYuf8"
                  target="_blank"
                  class="bg-background/60 hover:bg-background/80 flex items-center gap-2 rounded-lg border border-white/6 px-3 py-2 text-sm"
                >
                  <i data-lucide="message-circle" class="h-4 w-4"></i>Discord
                </a>
              </div>
            </div>
          </section>
        </main>
      </div>

      <div data-notification class="toast fixed right-6 bottom-6 hidden">
        <div class="flex items-center gap-2 rounded-lg border border-[#10b981]/40 bg-[#10b981]/20 px-4 py-3 text-sm">
          <i data-lucide="check" class="h-4 w-4 text-[#10b981]"></i>
          <span>Settings saved</span>
        </div>
      </div>
    </div>

    <ImportLucide />
    <script>
      import('../utils/st').then(({ SettingsManager }) => SettingsManager.init());
      import('../utils/config').then(({ default: ConfigAPI }) => {
        document.querySelector('[data-about-blank]')?.addEventListener('click', async () => {
          if (top?.location.href === 'about:blank') return;
          const win = top?.window.open();
          if (top && top.window) {
            top.window.location.href = (await ConfigAPI.get('panicLoc')) || 'https://google.com';
          }
          if (!win) return;

          const iframe = win.document.createElement('iframe');
          iframe.style.cssText = 'width:100%;height:100vh;border:0;margin:0;padding:0';
          iframe.src = location.origin + '/';

          win.document.body.style.margin = '0';
          win.document.title = 'about:blank';
          win.document.body.appendChild(iframe);
        });
      });
    </script>
  </body>
</html>
